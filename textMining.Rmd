---
title: "Proyecto de Text Mining"
author: "Bryan Velicka Leka y Franco Manuel García Dos Santos"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# ---------------------- Introducción ---------------------- #

En este documento haremos text mining sobre los pdfs dados y haremos un pequeño
trabajo de investigación.


# ------------------ Manipulación dataset ------------------ #

## 0. Carga de paquetes necesarios
```{r message=FALSE, warning=FALSE}
library(tm)
library(pdftools)
library(stringr)
library(stringi)
library(wordcloud)
library(ggplot2)

```


```{r}
directorio.textos <- file.path("./","pdfstextmining2021")

directorio.textos

dir(directorio.textos)

list.files <- DirSource(directorio.textos)

texts <- lapply(list.files, pdf_text)

length(texts)

lapply(texts, length)

corpus <- VCorpus(VectorSource(texts))
inspect(corpus)$meta


clean_corpus <- function(corpus){
  corpus <- tm_map(corpus, removePunctuation, ucp = TRUE)
  corpus <- tm_map(corpus,stripWhitespace)
  corpus <- tm_map(corpus,content_transformer(tolower))
  corpus <- tm_map(corpus, removeWords, c(stopwords("en")) )
  return(corpus)
}

corpus <- clean_corpus(corpus)

```

#Contenedor para eliminar caracteres especiales
```{r}
removeSpCh <- content_transformer(function (x , pattern ) gsub(pattern, " ", x) )

corpus <- tm_map(corpus, removeSpCh, "\n")
corpus <- tm_map(corpus, removeSpCh, "\f")

```


#Crear TDM y inspeccionar
```{r}
#to_TDM <- function(my_corpus){
#    my_corpus <- TermDocumentMatrix(my_corpus,
#                                    control = 
#                                    list( removePunctuation = TRUE,
#                                          stopwords = stopwords(kind = "en"),
#                                          tolower = TRUE,
#                                          stemming = FALSE,
#                                          removeNumbers = TRUE
#                                           ) )
#}

#my_tdm <- to_TDM(corpus)
#-------------------#
my_tdm <- TermDocumentMatrix(corpus)

frequent_terms <-  findFreqTerms(my_tdm, 
              lowfreq = 25, 
              highfreq = Inf)
frequent_terms

matrix_tdm <- as.matrix(my_tdm[frequent_terms,])
matrix_tdm

freq <- rowSums(matrix_tdm)

set.seed(142)   
wordcloud(names(freq), freq, min.freq=5, scale=c(5, .1))
#--------------------#

dtm <- DocumentTermMatrix(corpus)

freq <- colSums(as.matrix(dtm))

set.seed(142)   
dark2 <- brewer.pal(6, "Dark2")
wordcloud(names(freq), freq, min.freq=15, max.words = 50, scale=c(5, .1), colors = dark2)

```

